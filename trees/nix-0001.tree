\title{NixOS RFC42-style module as libaray}
\date{2024-04-08}
\author{jinser}

\p{ä¸çŸ¥é“å«åš RFC42-style module è¿™ä¸ªåå­—åˆé€‚ä¸åˆé€‚ï¼Œå› ä¸º RFC42 å®é™…ä¸Šå¹¶ä¸æ˜¯å®šä¹‰ module çš„ã€‚ä½†æ˜¯æ—¢ç„¶ [flake.parts è¿™ä¹ˆå«äº†](https://flake.parts/define-custom-flake-attribute.html?highlight=rfc#configflake)ï¼Œé‚£å°±ç»§ç»­æ²¿ç”¨äº†ã€‚}

\transclude{nix-0002}

\p{åœ¨ nix ç¨‹åºçš„ç»„ç»‡ä¸­ï¼Œç»å¸¸éœ€è¦ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é»˜è®¤æä¾›å®šä¹‰æ–¹å¼çš„æ˜¯ libaray çš„å†™æ³•ã€‚å³æœ‰ä¸€ç³»åˆ—å¸¸ç”¨æˆ–ç›¸å…³çš„å‡½æ•°ï¼Œæƒ³è¦åœ¨ç¨‹åºçš„å…¨å±€ä¸­æ–¹ä¾¿åœ°è°ƒç”¨ã€‚}

\p{æœ€ç›´è§‰æƒ³åˆ°çš„è§£å†³æ–¹å¼æ˜¯ä¸€ä¸ª \code{mylib.nix}ï¼Œå…¶æ¥æ”¶ä¸€äº›å¿…è¦çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå«æ‰€æœ‰å‡½æ•°çš„ \code{attrset}ã€‚
\pre{
  { lib, inputs, nixpkgs }:
  {
    mkSystem = nixpkgs.lib.nixosSystem { ... };

    mkEmptyFreeformOption = description: lib.mkOption {
      type = lib.types.submodule {
        freeformType = format.type;
      };
      default = { };
      inherit description;
    };
  }
}

ç¤¾åŒºä¸­çš„ä¾‹å­ğŸŒ°ï¼š
\ol{
  \li{[Ryan4yin çš„ NixOS config](https://github.com/ryan4yin/nix-config/blob/487d410e70ed4298e45cbe9dbf80bd22c558bd6e/lib/default.nix)}
  \li{[Mitchell Hashimoto çš„ NixOS config](https://github.com/mitchellh/nixos-config/blob/0bc623cded29408b041bb0792dd6bf893b43eecf/lib/mksystem.nix)}
}
}

\p{å¦å¤–ä¸€ä¸ªæ–¹å¼æ˜¯ä» [srid åœ¨ flake-parts ä¸­æçš„ issue](https://github.com/hercules-ci/flake-parts/issues/51) ä¸­å­¦åˆ°çš„ï¼Œåˆ©ç”¨ module å®ç°çš„å…¨å±€å…±äº«å‡½æ•°ã€‚å€ŸåŠ© module çš„è‡ªåŠ¨åˆå¹¶å’Œè‡ªåŠ¨åº”ç”¨ï¼Œå¯ä»¥æ¯”è¾ƒä¼˜é›…åœ°å…±äº« libarayã€‚ä¸è¿‡ä¸ç¡®å®šçš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ä¹ˆåšæ˜¯å¦æ„æˆäº†å¯¹ \code{options} çš„æ»¥ç”¨ï¼Œæˆ–è€…è¯´è¿åäº† \code{options} çš„è¯­ä¹‰ã€‚}

\p{å°½ç®¡è¯¥ issue è¿˜å¤„äº open çŠ¶æ€ï¼Œflake-parts å¯¹äºè¿™ä¸ªé—®é¢˜è¿˜æ²¡æœ‰å…±è¯†ã€‚ä½†åœ¨è‡ªå·±çš„é…ç½®ä¸­è¿™ä¹ˆåšè¿˜æ˜¯æ²¡æœ‰é—®é¢˜ã€‚}

\transclude{nix-0007}
